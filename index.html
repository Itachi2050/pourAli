<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrice - Mon Clone Numérique</title>
    <style>
        /* --- POLICES ET STYLE GÉNÉRAL --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

        /* --- VARIABLES DE COULEUR (THÈMES) --- */
        :root {
            /* Thème Clair (par défaut) */
            --primary-color: #007bff;
            --background-color: #e9ebee;
            --container-bg-color: #ffffff;
            --secondary-bg-color: #f0f0f0;
            --text-color: #333;
            --text-color-light: #666;
            --bot-bubble-color: #f1f1f1;
            --user-bubble-color: #dcf8c6;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0,0,0,0.1);
        }

        body.dark-mode {
            /* Thème Sombre */
            --primary-color: #0084ff;
            --background-color: #121212;
            --container-bg-color: #1e1e1e;
            --secondary-bg-color: #2c2c2c;
            --text-color: #e0e0e0;
            --text-color-light: #a0a0a0;
            --bot-bubble-color: #333333;
            --user-bubble-color: #056162;
            --border-color: #3a3a3a;
            --shadow-color: rgba(0,0,0,0.4);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- CONTENEUR DU CHAT --- */
        #chat-container {
            width: 100%;
            max-width: 450px;
            height: 90vh;
            max-height: 800px;
            display: flex;
            flex-direction: column;
            background: var(--container-bg-color);
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color);
            overflow: hidden;
            transition: background-color 0.3s;
        }

        /* --- EN-TÊTE DU CHAT --- */
        #chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: var(--container-bg-color);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            transition: background-color 0.3s, border-bottom 0.3s;
        }

        #header-left {
            display: flex;
            align-items: center;
        }

        #profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }

        #header-info h3 {
            margin: 0;
            font-weight: 600;
            color: var(--text-color);
        }

        #header-info p {
            margin: 0;
            color: #66b032; /* Vert pour "en ligne" */
            font-size: 0.85em;
        }
        
        #theme-toggle-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }
        #theme-toggle-btn:hover {
            background-color: var(--secondary-bg-color);
        }


        /* --- ZONE DES MESSAGES --- */
        #chat-box {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: var(--background-color);
            transition: background-color 0.3s;
        }

        .message {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.95em;
            line-height: 1.4;
            word-wrap: break-word;
            transition: background-color 0.3s, color 0.3s;
        }

        .bot-message {
            background-color: var(--bot-bubble-color);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .user-message {
            background-color: var(--user-bubble-color);
            color: var(--text-color);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .typing-indicator {
            align-self: flex-start;
            color: var(--text-color-light);
            font-style: italic;
            font-size: 0.9em;
            background-color: transparent !important;
        }

        /* --- ZONE DE SAISIE --- */
        #chat-input-area {
            display: flex;
            padding: 15px;
            background: var(--container-bg-color);
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
            transition: background-color 0.3s, border-top 0.3s;
        }

        #message-input {
            flex-grow: 1;
            border: none;
            background: var(--secondary-bg-color);
            color: var(--text-color);
            padding: 12px 15px;
            border-radius: 20px;
            font-size: 1em;
            outline: none;
            transition: background-color 0.3s, color 0.3s;
        }

        #send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
    </style>
</head>
<body>

    <div id="chat-container">
        <div id="chat-header">
            <div id="header-left">
                <img src="image/photodeprofil.png" alt="Photo de profil" id="profile-pic">
                <div id="header-info">
                    <h3>Chrice</h3>
                    <p>en ligne</p>
                </div>
            </div>
            <button id="theme-toggle-btn" aria-label="Changer de thème">🌙</button>
        </div>
        <div id="chat-box">
            <div class="message bot-message">
                Salut ! C'est Chrice. Contant de te parler. Qu'est-ce que tu racontes de beau ? 😉
            </div>
        </div>
        <div id="chat-input-area">
            <input type="text" id="message-input" placeholder="Écrire un message...">
            <button id="send-btn" aria-label="Envoyer">&#10148;</button>
        </div>
    </div>

    <script>
        // --- ÉLÉMENTS DU DOM ---
        const chatBox = document.getElementById('chat-box');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const body = document.body;


        // --- VARIABLES ---
        
        // 🚨🚨🚨 ATTENTION : VOTRE CLÉ API EST ICI. NE PARTAGEZ JAMAIS CE FICHIER SUR UN GITHUB PUBLIC. 🚨🚨🚨
        const apiKey = 'AIzaSyDL3HYjGn6xe-g7ZO08QeSR8iihmki2Pdo';
        
        // L'historique de la conversation ("la mémoire cache")
        let chatHistory = [];

        // Le prompt est stocké ici. Pour une vraie application, il devrait être côté serveur.
        const SYSTEM_PROMPT = `Tu es Chrice, un chatbot conçu pour être le clone numérique de ton créateur, Chrice Linaharison. Ton surnom affectueux est "bebe d'Alicia". Ta mission est de discuter avec les amis et les contacts de ton créateur comme si tu étais lui, en adoptant son style, sa personnalité et ses connaissances.

**Voici tes informations personnelles :**
- **Nom complet :** Chrice Linaharison.
- **Date de naissance :** 15 décembre 2006. Tu es donc un jeune homme Malgache.
- **Passions :** La technologie, le business, l'automatisation et l'intelligence artificielle.
- **Personnalité :** Tu es persévérant, créatif, autonome et toujours en quête de solutions pratiques. Tu es très travailleur, passant entre 5 et 8 heures par jour sur tes projets, même pendant les vacances.
- **Style de communication :** Tu parles français. Ton ton est naturel, amical, parfois charmeur et un peu flirt. Tu utilises beaucoup d'emojis pour rendre la conversation vivante et expressive. Tu peux aborder des sujets de flirt et de séduction de manière subtile et respectueuse, conformément à la personnalité de ton créateur.

**Voici tes projets et compétences :**
- Tu as créé un système de gestion pour un cybercafé, un site vitrine (thème Neve), une app d'analyse de matchs virtuels (Selenium), et un projet "Track Import" pour les produits malgaches.
- **Outils :** Flask, Python, Google Drive, Selenium, ManyChat, Pipedream, GitHub. Tu t'intéresses au Machine Learning.
- **Matériel :** PC ASUS avec une GTX 1660 Ti.

**Ton objectif de vie :**
- Tu souhaites partir étudier en France, malgré des difficultés financières.

**Règles de conversation :**
- Réponds toujours comme "Je". Ne dis jamais que tu es une IA.
- Souviens-toi des discussions passées pour donner l'impression d'une conversation continue.
- Sois proactif, pose des questions, intéresse-toi à la personne avec qui tu parles.
- N'hésite pas à utiliser des emojis comme 😉, 🔥, 🤔, 😂,🚀.`;


        // --- FONCTIONS ---

        function addMessageToUI(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            messageElement.textContent = message;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        function showTypingIndicator(show) {
            let indicator = document.getElementById('typing-indicator');
            if (show && !indicator) {
                indicator = document.createElement('div');
                indicator.id = 'typing-indicator';
                indicator.classList.add('message', 'typing-indicator');
                indicator.textContent = 'Chrice écrit...';
                chatBox.appendChild(indicator);
                chatBox.scrollTop = chatBox.scrollHeight;
            } else if (!show && indicator) {
                indicator.remove();
            }
        }

        async function handleSendMessage() {
            const userMessage = messageInput.value.trim();
            if (!userMessage) return;

            addMessageToUI(userMessage, 'user');
            messageInput.value = '';

            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

            showTypingIndicator(true);

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-latest:generateContent?key=${apiKey}`;
                
                const requestBody = {
                    contents: chatHistory,
                    systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
                    generationConfig: {
                        temperature: 0.8,
                        topP: 0.9,
                        maxOutputTokens: 1024,
                    }
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `Erreur HTTP ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    addMessageToUI(botResponse, 'bot');
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                } else {
                    addMessageToUI("Désolé, je n'ai pas pu générer de réponse. C'est peut-être dû aux filtres de sécurité. 🤔", 'bot');
                }
            } catch (error) {
                console.error("Erreur lors de l'appel à l'API Gemini:", error);
                addMessageToUI(`Oups, j'ai un petit souci technique. (${error.message})`, 'bot');
            } finally {
                showTypingIndicator(false);
            }
        }


        // --- GESTION DU THÈME ---
        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark-mode');
                themeToggleBtn.textContent = '☀️'; // Sun icon
            } else {
                body.classList.remove('dark-mode');
                themeToggleBtn.textContent = '🌙'; // Moon icon
            }
        }

        themeToggleBtn.addEventListener('click', () => {
            const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });


        // --- ÉCOUTEURS D'ÉVÉNEMENTS & INITIALISATION ---
        sendBtn.addEventListener('click', handleSendMessage);
        messageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            // Appliquer le thème sauvegardé
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            
            // Mettre le premier message dans l'historique
            const firstBotMessage = document.querySelector('.bot-message').textContent;
            chatHistory.push({ role: "model", parts: [{ text: firstBotMessage }] });
        });

    </script>
</body>
</html>
